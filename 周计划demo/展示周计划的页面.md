``` dataviewjs
/* 配置 */
const DAILY_FOLDER = "diary";
const DATE_FORMAT  = "YYYY-MM-DD"; // 例：2025-08-12-周二
const START_OF_WEEK = "isoWeek";
const TODO_HEADER   = "todo";          // 仅渲染此分区（大小写不敏感）

const moment = window.moment;
moment.locale("zh-cn");

/* 判断任务是否在 TODO 分区（含其子分区，大小写不敏感） */
function inTodoSection(subpath) {
  if (!subpath) return false;
  const segs = String(subpath)
    .toLowerCase()
    .split(">")
    .map(s => s.replace(/#/g, "").trim());
  return segs.includes(TODO_HEADER.toLowerCase());
}

/* 容器（不再内联样式） */
const wrap = document.createElement("div");
wrap.className = "wk-wrap";
dv.container.appendChild(wrap);

/* 本周日期 */
const start = moment().startOf(START_OF_WEEK);
const days  = Array.from({ length: 7 }, (_, i) => start.clone().add(i, "day"));

/* 获取某天的 TODO 任务 */
function getDayTasks(name) {
  return dv.pages('"' + DAILY_FOLDER + '"')
    .where(p => p.file.name === name)
    .flatMap(p => p.file.tasks)
    .where(t => inTodoSection(t.section?.subpath || ""));
}

/* 精确定位并改写任务行：仅切换 [ ]/[x] */
async function locateAndModify(task, replacer) {
  const file = app.vault.getAbstractFileByPath(task.path);
  if (!file) return false;
  const content = await app.vault.read(file);
  const lines = content.split("\n");

  const normalize = s => s.replace(/^- \[[ xX]\]\s*/, "").trim();
  const looksTask = s => /^- \[[ xX]\]\s+/.test(s);

  let idx = (task.line ?? -1);
  const inRange = i => i >= 0 && i < lines.length;

  const tryMatch = () => {
    if (inRange(idx) && looksTask(lines[idx])) return idx;
    for (let d = -3; d <= 3; d++) {
      const i = idx + d;
      if (inRange(i) && looksTask(lines[i]) && normalize(lines[i]) === (task.text || "").trim()) return i;
    }
    let i = lines.findIndex(l => looksTask(l) && normalize(l) === (task.text || "").trim());
    if (i !== -1) return i;
    i = lines.findIndex(l => looksTask(l) && l.includes(task.text || ""));
    return i;
  };

  const lineIdx = tryMatch();
  if (lineIdx === -1) return false;

  lines[lineIdx] = replacer(lines[lineIdx]);
  await app.vault.modify(file, lines.join("\n"));
  return true;
}

/* 勾选：只改 [ ]/[x] */
async function toggleTask(task, checked) {
  return locateAndModify(task, line => line.replace(/^- \[[ xX]\]/, `- [${checked ? "x" : " "}]`));
}

/* 列进度 */
function updateColProgress(col) {
  const total = col.querySelectorAll(".wk-task").length;
  const done  = col.querySelectorAll(".wk-task.done").length;
  const pct   = total ? Math.round((done / total) * 100) : 0;
  const bar   = col.querySelector(".wk-bar > span");
  const pctEl = col.querySelector(".wk-pct");
  if (bar)   bar.style.width   = pct + "%";
  if (pctEl) pctEl.textContent = pct + "%";
}

/* 渲染单行任务 */
function renderTaskRow(listEl, colEl, taskObj) {
  const row = document.createElement("div");
  row.className = "wk-task" + (taskObj.completed ? " done" : "");

  const cb = document.createElement("input");
  cb.type = "checkbox";
  cb.checked = !!taskObj.completed;

  const txt = document.createElement("div");
  txt.className = "wk-text";
  txt.textContent = taskObj.text;

  cb.addEventListener("change", async () => {
    cb.disabled = true;
    try {
      await toggleTask(taskObj, cb.checked);
      row.classList.toggle("done", cb.checked);
      updateColProgress(colEl);
    } finally {
      cb.disabled = false;
    }
  });

  row.appendChild(cb);
  row.appendChild(txt);
  listEl.appendChild(row);
}

/* 渲染网格 */
const grid = document.createElement("div");
grid.className = "wk-grid";
wrap.appendChild(grid);

for (const day of days) {
  const name = day.format(DATE_FORMAT);

  const col = document.createElement("div");
  col.className = "wk-col";
  grid.appendChild(col);

  // 头部：点击跳转到日记
  const head = document.createElement("div");
  head.className = "wk-head";
  const link = document.createElement("a");
  link.textContent = name;
  link.href = "#";
  link.addEventListener("click", (e) => {
    e.preventDefault();
    app.workspace.openLinkText(`${DAILY_FOLDER}/${name}`, dv.current().file.path, false);
  });
  head.appendChild(link);
  col.appendChild(head);

  // 进度条
  const prog = document.createElement("div");
  prog.className = "wk-progress";
  prog.innerHTML = `<div class="wk-bar"><span style="width:0%"></span></div><div class="wk-pct">0%</div>`;
  col.appendChild(prog);

  // 列表
  const list = document.createElement("div");
  list.className = "wk-list";
  col.appendChild(list);

  const tasks = getDayTasks(name);
  if (!tasks.length) {
    const empty = document.createElement("div");
    empty.className = "wk-empty";
    empty.textContent = "无 TODO 任务或未建日记";
    list.appendChild(empty);
  } else {
    for (const t of tasks) {
      renderTaskRow(list, col, { path: t.path, line: t.line, text: t.text, completed: t.completed });
    }
  }

  updateColProgress(col);
}
```